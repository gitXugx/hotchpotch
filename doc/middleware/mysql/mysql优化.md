# mysql哪些是需要关注的地方
> MySQL 是最流行的关系型数据库管理系统，在 WEB 应用方面 MySQL 是最好的 RDBMS(Relational Database Management System：关系数据库管理系统)应用软件之一。

**什么是关系型数据库:**
数据库（Database）是按照数据结构来组织、存储和管理数据的仓库。我们也可以将数据存储在文件中，但是在文件中读写数据速度相对较慢。
关系型数据库的特点：
1. 数据以表格的形式出现
2. 每行为各种记录
3. 每列为记录名称所对应的字段
4. 许多的行和列组成一张表
5. 若干的表单组成database

## 存储引擎
mysql 存储引擎分为两种: 
1. MyISAM : 不支持事务、故障恢复困难、锁为表级锁粒度大，在mysql5.6之后官方推荐innoDB。适合读多写少、数据可丢失的场景
2. InnoDB ：支持事务、行级锁、支持故障恢复

可以看到现在绝大部分使用mysql都是使用的InnoDB引擎，事务的支持使数据保证一致性，行级锁使其支持更高的并发，作为企业级数据库，绝大部分业务数据不能丢失，innodb通过binlog来恢复故障。渐渐的innodb成为主流存储引擎。

## 索引
InnoDB和MyISAM 都支持索引，但是索引的方式不同，InnoDB是聚簇索引，MyISAM 是非聚簇索引。
聚簇索引: 
聚簇索引一般为主键，主键为一颗B+TREE叶子节点存放具体每一行的数据，其它创建的索引为辅助索引，辅助索引存放主键，当使用辅助索引查询到数据后，如果返回的是索引字段，则直接从索引中取出即可，如果不是则需要查询聚簇索引进行二次查找，找到对应的聚簇索引然后进行索引查询。

非聚簇索引: 索引指向对应的行，不用进行二次查询。

**为什么InnoDB的索引是以B+TREE存储**
作为数据库，数据肯定是存放到磁盘上的，数据的读取是消耗IO的。如果使用二叉树查询一次最坏的IO情况是树的高度，而且在极端的情况下二叉树有可能会退化成链表。红黑树平衡树，实际上只是解决来了二叉树的退化链表的问题，但是还是没能解决二叉树节点过多的问题，因为每一次IO只读取一个节点。B-TREE 是为磁盘读取数据而生成的数据结构，B-TREE 每个节点存放一个page，数据从磁盘中读取到内存中是一页一页的，mysql由设置每页的大小，默认是一页16k，B-TREE每个节点是指针加索引加数据的形式。B-TREE使树的高度降低，这样每次IO的次数就会缩减，而实际上随着每页都存有数据的情况下，数据量大，树的高度还会变高，而且不支持范围查询。B+TREE 是把所有的数据存储在叶子节点，叶子节点会存放下一个叶子节点的指针，形成一个单向链表，以共范围查询

## 事务

## 高可用
数据库的主从架构其实和redis主从架构有相似之处，只不过mysql主从架构保证数据不丢失。数据不丢失的做法是从服务器必须执行完ACK后主服务器进行恢复客户端，否则等待。可以使用master高可用架构。

## 优化

1. 主键最好是有序的，因为在聚簇索引中添加数据或者删除数据可能会发生裂页的问题，影响效率
2. 上面说到索引是B+TREE所以在创建索引的时候应该尽量保持树的高度比较低，才能减少IO次数。可以设置page大小，创建索引的时候尽量字段应该稍微较小，增大每page的大小，减小树的高度。
3. 尽量保证事务比较小，如果只是RPC或网络调用、查询不需要添加事务。





